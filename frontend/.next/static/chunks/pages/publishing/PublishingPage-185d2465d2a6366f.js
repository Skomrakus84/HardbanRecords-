(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258,880],{2258:(e,t,l)=>{"use strict";l.r(t),l.d(t,{aiApi:()=>n,apiClient:()=>i,musicApi:()=>a,tasksApi:()=>s,uploadFileToS3:()=>r});let i=l(1040).A.create({baseURL:"http://localhost:3001/api",headers:{"Content-Type":"application/json"}});async function r(e){let{data:t}=await i.get("/s3-presigned-url",{params:{fileName:e.name,fileType:e.type}});return await fetch(t.presignedUrl,{method:"PUT",headers:{"Content-Type":e.type},body:e}),{fileUrl:t.fileUrl}}let a={getAll:()=>i.get("/music/releases"),create:e=>i.post("/music/releases",e),update:(e,t)=>i.patch("/music/releases/".concat(e),t),delete:e=>i.delete("/music/releases/".concat(e)),updateSplits:(e,t)=>i.patch("/music/releases/".concat(e,"/splits"),{splits:t})},s={getAll:()=>i.get("/music/tasks"),create:e=>i.post("/music/tasks",e),update:(e,t)=>i.patch("/music/tasks/".concat(e),t),delete:e=>i.delete("/music/tasks/".concat(e))},n={generateImage:e=>i.post("/ai/generate-images",{prompt:e}),generateContent:e=>i.post("/ai/generate-content",{prompt:e})}},4575:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>o});var i=l(7876),r=l(4232),a=l(2604),s=l(2258);let n=e=>{let{chapter:t,onSave:l,onCancel:a}=e,[n,o]=(0,r.useState)(t.title),[d,c]=(0,r.useState)(t.content),[u,h]=(0,r.useState)(null),[p,g]=(0,r.useState)(null),[y,x]=(0,r.useState)(null),[j,m]=(0,r.useState)(t.imageUrl||""),[b,k]=(0,r.useState)(t.audioUrl||""),[f,w]=(0,r.useState)(t.fileUrl||""),[v,C]=(0,r.useState)(!1),[S,z]=(0,r.useState)({}),B=async(e,t)=>{C(!0);try{let{fileUrl:l}=await (0,s.uploadFileToS3)(e);t(l)}catch(e){alert("Błąd uploadu pliku.")}C(!1)};return(0,i.jsxs)("div",{style:{background:"#222",padding:24,borderRadius:8,maxWidth:600,margin:"0 auto"},children:[(0,i.jsx)("h3",{style:{color:"white"},children:"Edycja rozdziału"}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Tytuł:",(0,i.jsx)("input",{type:"text",value:n,onChange:e=>o(e.target.value),style:{width:"100%"}})]}),S.title&&(0,i.jsx)("div",{style:{color:"red",fontSize:13},children:S.title})]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Treść:",(0,i.jsx)("textarea",{value:d,onChange:e=>c(e.target.value),style:{width:"100%"}})]}),S.content&&(0,i.jsx)("div",{style:{color:"red",fontSize:13},children:S.content})]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Obraz:",(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return h((null==(t=e.target.files)?void 0:t[0])||null)}})]}),u&&(0,i.jsx)("button",{type:"button",onClick:()=>B(u,m),disabled:v,children:"Wyślij obraz"}),j&&(0,i.jsx)("img",{src:j,alt:"obraz",style:{height:40,marginLeft:8,verticalAlign:"middle"}})]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Audio:",(0,i.jsx)("input",{type:"file",accept:"audio/*",onChange:e=>{var t;return g((null==(t=e.target.files)?void 0:t[0])||null)}})]}),p&&(0,i.jsx)("button",{type:"button",onClick:()=>B(p,k),disabled:v,children:"Wyślij audio"}),b&&(0,i.jsxs)("span",{style:{color:"white",marginLeft:8},children:["Plik audio załadowany",(0,i.jsx)("audio",{controls:!0,src:b,style:{display:"block",marginTop:8,maxWidth:300},children:"Tw\xf3j przeglądarka nie obsługuje odtwarzacza audio."})]})]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Dowolny plik:",(0,i.jsx)("input",{type:"file",onChange:e=>{var t;return x((null==(t=e.target.files)?void 0:t[0])||null)}})]}),y&&(0,i.jsx)("button",{type:"button",onClick:()=>B(y,w),disabled:v,children:"Wyślij plik"}),f&&(0,i.jsxs)("span",{style:{color:"white",marginLeft:8},children:["Plik załadowany",(0,i.jsx)("div",{style:{marginTop:8},children:f.endsWith(".pdf")?(0,i.jsx)("iframe",{src:f,style:{width:300,height:200,border:"1px solid #444",background:"#fff"},title:"Podgląd pliku PDF"}):(0,i.jsx)("a",{href:f,target:"_blank",rel:"noopener noreferrer",style:{color:"#90caf9"},children:"Pobierz / Otw\xf3rz plik"})})]})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[(0,i.jsx)("button",{type:"button",onClick:a,style:{background:"#666",color:"white",padding:"10px 20px",border:"none",borderRadius:4},children:"Anuluj"}),(0,i.jsx)("button",{type:"button",onClick:()=>{let e={};if(n.trim()||(e.title="Tytuł jest wymagany."),d.trim()||(e.content="Treść jest wymagana."),Object.keys(e).length>0)return void z(e);z({}),l({title:n,content:d,imageUrl:j,audioUrl:b,fileUrl:f})},disabled:v,style:{background:v?"#888":"#4CAF50",color:"white",padding:"10px 20px",border:"none",borderRadius:4},children:"Zapisz"})]})]})},o=e=>{let{bookId:t,onBack:l}=e,s=(0,a.C)(e=>e.publishing.books.find(e=>e.id===t)),o=(0,a.C)(e=>e.updateChapterContent),d=(0,a.C)(e=>e.addChapter),c=(0,a.C)(e=>e.replaceBookChapters),[u,h]=(0,r.useState)(null);return s?(0,i.jsxs)("div",{style:{padding:32},children:[(0,i.jsxs)("h2",{style:{color:"white"},children:["Rozdziały książki: ",s.title]}),(0,i.jsx)("button",{onClick:l,style:{marginBottom:24,background:"#666",color:"white",padding:"10px 20px",border:"none",borderRadius:4},children:"Powr\xf3t"}),(0,i.jsx)("ul",{style:{color:"white",marginBottom:24},children:s.chapters.map((e,l)=>(0,i.jsxs)("li",{style:{marginBottom:16},children:[(0,i.jsx)("strong",{children:e.title||"Rozdział ".concat(l+1)}),(0,i.jsx)("button",{style:{marginLeft:16},onClick:()=>h(l),children:"Edytuj"}),(0,i.jsx)("button",{style:{marginLeft:8,color:"red"},onClick:()=>{c(t,s.chapters.filter((e,t)=>t!==l))},children:"Usuń"}),e.imageUrl&&(0,i.jsx)("img",{src:e.imageUrl,alt:"obraz",style:{height:32,marginLeft:8,verticalAlign:"middle"}}),e.audioUrl&&(0,i.jsx)("span",{style:{marginLeft:8},children:"[audio]"}),e.fileUrl&&(0,i.jsx)("span",{style:{marginLeft:8},children:"[plik]"})]},l))}),(0,i.jsx)("button",{onClick:()=>d(t),style:{background:"#2196F3",color:"white",padding:"8px 16px",border:"none",borderRadius:4,marginBottom:24},children:"Dodaj rozdział"}),null!==u&&(0,i.jsx)(n,{chapter:s.chapters[u],onSave:async e=>{await o(t,u,e.content);let l=s.chapters.map((t,l)=>l===u?{...e}:t);a.C.getState().replaceBookChapters(t,l),h(null)},onCancel:()=>h(null)})]}):(0,i.jsx)("div",{style:{color:"white"},children:"Nie znaleziono książki."})}},7120:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>d});var i=l(7876),r=l(4232),a=l(4575),s=l(2604),n=l(2258);let o=e=>{let{onClose:t}=e,l=(0,s.C)(e=>e.addBook),[a,o]=(0,r.useState)({title:"",author:"",genre:"",blurb:"",keywords:"",coverImageUrl:"",splits:[{name:"",share:""}],chapters:[{title:"",content:""}],rights:{territorial:!1,translation:!1,adaptation:!1,drm:!1}}),[d,c]=(0,r.useState)(null),[u,h]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),[y,x]=(0,r.useState)(!1),[j,m]=(0,r.useState)(""),[b,k]=(0,r.useState)({}),f=async e=>{e.preventDefault();let i={};if(a.title.trim()||(i.title="Tytuł jest wymagany."),a.author.trim()||(i.author="Autor jest wymagany."),a.genre.trim()||(i.genre="Gatunek jest wymagany."),d||a.coverImageUrl||(i.cover="Okładka jest wymagana."),Object.keys(i).length>0)return void k(i);k({}),x(!0);let r=a.coverImageUrl;try{if(d){let{fileUrl:e}=await (0,n.uploadFileToS3)(d);r=e}let e=[];for(let t=0;t<u.length;t++){let l=u[t],{fileUrl:i}=await (0,n.uploadFileToS3)(l);e.push({url:i,prompt:j||""})}await l({...a,coverImageUrl:r,status:"Draft",illustrations:[...p,...e]}),x(!1),t()}catch(e){alert("Błąd uploadu pliku."),x(!1)}};return(0,i.jsxs)("div",{style:{background:"#222",padding:24,borderRadius:8,maxWidth:600,margin:"0 auto"},children:[(0,i.jsx)("h2",{style:{color:"white"},children:"Dodaj książkę"}),(0,i.jsxs)("form",{onSubmit:f,children:[(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Tytuł:",(0,i.jsx)("input",{type:"text",value:a.title,onChange:e=>o(t=>({...t,title:e.target.value})),style:{width:"100%"}})]}),b.title&&(0,i.jsx)("div",{style:{color:"red",fontSize:13},children:b.title})]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Autor:",(0,i.jsx)("input",{type:"text",value:a.author,onChange:e=>o(t=>({...t,author:e.target.value})),style:{width:"100%"}})]}),b.author&&(0,i.jsx)("div",{style:{color:"red",fontSize:13},children:b.author})]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Gatunek:",(0,i.jsx)("input",{type:"text",value:a.genre,onChange:e=>o(t=>({...t,genre:e.target.value})),style:{width:"100%"}})]}),b.genre&&(0,i.jsx)("div",{style:{color:"red",fontSize:13},children:b.genre})]}),(0,i.jsx)("div",{style:{marginBottom:12},children:(0,i.jsxs)("label",{style:{color:"white"},children:["Blurb:",(0,i.jsx)("textarea",{value:a.blurb,onChange:e=>o(t=>({...t,blurb:e.target.value})),style:{width:"100%"}})]})}),(0,i.jsx)("div",{style:{marginBottom:12},children:(0,i.jsxs)("label",{style:{color:"white"},children:["Słowa kluczowe:",(0,i.jsx)("input",{type:"text",value:a.keywords,onChange:e=>o(t=>({...t,keywords:e.target.value})),style:{width:"100%"}})]})}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Okładka:",(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{e.target.files&&e.target.files[0]&&c(e.target.files[0])}})]}),d&&(0,i.jsxs)("span",{style:{color:"white"},children:["Wybrano: ",d.name]}),b.cover&&(0,i.jsx)("div",{style:{color:"red",fontSize:13},children:b.cover})]}),(0,i.jsxs)("div",{style:{marginBottom:12},children:[(0,i.jsxs)("label",{style:{color:"white"},children:["Ilustracje:",(0,i.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>{e.target.files&&h(Array.from(e.target.files))}})]}),(0,i.jsx)("input",{type:"text",placeholder:"Prompt (opis ilustracji) - opcjonalnie dla wszystkich",value:j,onChange:e=>m(e.target.value),style:{width:"100%",marginTop:8}}),u.length>0&&(0,i.jsx)("ul",{style:{color:"white",marginTop:8},children:u.map((e,t)=>(0,i.jsxs)("li",{style:{display:"flex",alignItems:"center",gap:8},children:[e.name,(0,i.jsx)("button",{type:"button",style:{marginLeft:8},onClick:()=>h(e=>e.filter((e,l)=>l!==t)),children:"Usuń"})]},t))}),p.length>0&&(0,i.jsx)("ul",{style:{color:"white",marginTop:8},children:p.map((e,t)=>(0,i.jsxs)("li",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,i.jsx)("img",{src:e.url,alt:"ilustracja",style:{height:40,marginRight:8,verticalAlign:"middle"}}),e.prompt&&(0,i.jsx)("span",{style:{fontStyle:"italic",marginLeft:8},children:e.prompt}),(0,i.jsx)("button",{type:"button",style:{marginLeft:8},onClick:()=>g(e=>e.filter((e,l)=>l!==t)),children:"Usuń"})]},t))})]}),(0,i.jsxs)("div",{style:{display:"flex",gap:10,justifyContent:"flex-end"},children:[(0,i.jsx)("button",{type:"button",onClick:t,style:{background:"#666",color:"white",padding:"10px 20px",border:"none",borderRadius:4},children:"Anuluj"}),(0,i.jsx)("button",{type:"submit",disabled:y,style:{background:y?"#888":"#4CAF50",color:"white",padding:"10px 20px",border:"none",borderRadius:4},children:y?"Wysyłanie...":"Dodaj książkę"})]})]})]})},d=()=>{let[e,t]=(0,r.useState)(!1),[l,n]=(0,r.useState)(null),d=(0,s.C)(e=>e.publishing.books);return null!==l?(0,i.jsx)(a.default,{bookId:l,onBack:()=>n(null)}):(0,i.jsxs)("div",{style:{padding:32},children:[(0,i.jsx)("h1",{style:{color:"white"},children:"Publikacje"}),(0,i.jsx)("button",{style:{marginBottom:24,background:"#4CAF50",color:"white",padding:"10px 20px",border:"none",borderRadius:4},onClick:()=>t(!0),children:"Dodaj książkę"}),e&&(0,i.jsx)(o,{onClose:()=>t(!1)}),(0,i.jsxs)("div",{style:{marginTop:32},children:[(0,i.jsx)("h2",{style:{color:"white"},children:"Lista książek"}),(0,i.jsx)("ul",{children:d.map(e=>(0,i.jsxs)("li",{style:{color:"white",marginBottom:12},children:[(0,i.jsx)("strong",{children:e.title})," — ",e.author," (",e.genre,")",e.coverImageUrl&&(0,i.jsx)("img",{src:e.coverImageUrl,alt:"okładka",style:{height:60,marginLeft:16,verticalAlign:"middle",borderRadius:4}}),(0,i.jsx)("button",{style:{marginLeft:16},onClick:()=>n(e.id),children:"Edytuj rozdziały"})]},e.id))})]})]})}},9892:(e,t,l)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/publishing/PublishingPage",function(){return l(7120)}])}},e=>{e.O(0,[40,604,636,593,792],()=>e(e.s=9892)),_N_E=e.O()}]);